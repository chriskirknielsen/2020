"use strict";var utilityButtonLink="u-displayInlineFlex u-flex--centerBlock u-paddingInline--half u-fontBold u-c--grey-min u-bg--grey-max h_u-c--grey-min h_u-bg--grey-max u-border u-border--grey-med h_u-border--accent u-border-radius h_u-glowBox--accent h_u-textShadow--currentBg";window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var vhsWrapper=!1,vhsTapesList=[],mousePosition={x:!1,y:!1,new:!0};function numClamp(e,t,o){return Math.min(Math.max(t,e),o)}function numRemap(e,t,o,a,n){return(n-a)/(o-t)*(e-t)+a}function getXOffset(e,t){for(var o=0;e&&!isNaN(e.offsetLeft);)o+=e.offsetLeft-e.scrollLeft,e=e.offsetParent;return t-o}function orientVhsTapes(){if(requestAnimationFrame(orientVhsTapes),!1!==mousePosition.new&&!1!==mousePosition.x){var e=getXOffset(vhsWrapper,mousePosition.x),t=vhsWrapper.offsetWidth,i=Math.round(t/4),s=numClamp(-1*i,e,t+i);vhsTapesList.forEach(function(e){var t=e.offsetLeft,o=e.offsetWidth,a=t-i,n=t+o+i,r=numRemap(numClamp(a,s,n),a,n,-1,1);e.style.setProperty("--orientation-factor",r)})}}document.addEventListener("DOMContentLoaded",function(){var e="data-about-action",t=document.querySelectorAll("["+e+"]");if(t){for(var o=0;o<t.length;o++)if(!t[o].closest("svg")){var a=t[o].innerHTML,n=t[o].getAttribute(e),r='<button class="button--reset u-posRelative '+utilityButtonLink+'" '+e+'="'+n+'">'+a+"</button>";t[o].outerHTML=r}(t=Array.from(document.querySelectorAll("["+e+"]"))).forEach(function(t){"hooked-delorean"===t.getAttribute(e)&&t.addEventListener("click",function(){document.querySelector(".about__delorean").classList.toggle("about__delorean--with-hook")},!1),"synth-set-type"===t.getAttribute(e)&&t.addEventListener("click",function(e){return e.preventDefault(),document.querySelector('[data-synth-type][aria-pressed="true"]').setAttribute("aria-pressed","false"),t.setAttribute("aria-pressed","true"),!1},!1)})}reLabelKeys(),showMelodies(),vhsWrapper=document.querySelector('[data-grid-el="trinket-designs"]'),vhsTapesList=Array.from(document.querySelectorAll(".about__vhs")),vhsWrapper.addEventListener("mouseenter",function(e){var t="about__shirt--anim",o=document.querySelector(".about__shirt");o&&(o.classList.add(t),o.addEventListener("animationend",function(e){o.classList.remove(t)},{once:!0}))}),setTimeout(orientVhsTapes,100)});var melodies=["D  D  D  A GD  A GD    J  J  J  K GE  A GD".split(""),"G  Y   G Y G F Y G   A      G  Y   G Y G F Y G   K".split(""),"ASD G D S A   DGH K J G D  FDS".split("")],audioContext=new(window.AudioContext||window.webkitAudioContext),octaveOffset=1,keyNoteMap=[{note:"C",octave:1,key:"A",keyAzerty:"Q"},{note:"C#",octave:1,key:"W",keyAzerty:"Z"},{note:"D",octave:1,key:"S",keyAzerty:"S"},{note:"D#",octave:1,key:"E",keyAzerty:"E"},{note:"E",octave:1,key:"D",keyAzerty:"D"},{note:"F",octave:1,key:"F",keyAzerty:"F"},{note:"F#",octave:1,key:"T",keyAzerty:"T"},{note:"G",octave:1,key:"G",keyAzerty:"G"},{note:"G#",octave:1,key:"Y",keyAzerty:"Y"},{note:"A",octave:2,key:"H",keyAzerty:"H"},{note:"A#",octave:2,key:"U",keyAzerty:"U"},{note:"B",octave:2,key:"J",keyAzerty:"J"},{note:"C",octave:2,key:"K",keyAzerty:"K"}];function getAzertyForKey(t){return" "===t?" ":keyNoteMap.find(function(e){return e.key===t}).keyAzerty}function getHz(){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4,t=0;switch(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"A"){default:case"A":t=0;break;case"A#":case"Bb":t=1;break;case"B":t=2;break;case"C":t=3;break;case"C#":case"Db":t=4;break;case"D":t=5;break;case"D#":case"Eb":t=6;break;case"E":t=7;break;case"F":t=8;break;case"F#":case"Gb":t=9;break;case"G":t=10;break;case"G#":case"Ab":t=11}return t+=12*(e-4),440*Math.pow(2,t/12)}function playKey(e){var t=document.querySelector('[data-synth-type][aria-pressed="true"]').getAttribute("data-synth-type")||"sinewave",o=audioContext.createOscillator(),a=audioContext.createGain();a.connect(audioContext.destination);a.gain.value=1e-5;a.gain.exponentialRampToValueAtTime(.5,audioContext.currentTime+.01),a.gain.exponentialRampToValueAtTime(.001,audioContext.currentTime+1),a.gain.exponentialRampToValueAtTime(1e-5,audioContext.currentTime+2),o.connect(a),o.type=t;var n=getHz(e.note,(e.octave||0)+octaveOffset);Number.isFinite(n)&&(o.frequency.value=n),e.element.classList.add("pressed"),pressedNotes.set(e,o),pressedNotes.get(e).start()}function stopKey(e){if(e){e.element.classList.remove("pressed");var t=pressedNotes.get(e);t&&(setTimeout(function(){t.stop()},2e3),pressedNotes.delete(e))}}var getNoteByKey=function(t){return keyNoteMap.find(function(e){return("AZERTY"===getKeyboardLayout()?e.keyAzerty:e.key)===t})||!1},getKeyByNoteOctave=function(t,o){return keyNoteMap.find(function(e){return e.note===t&&e.octave===parseInt(o,10)})||!1},pressedNotes=new Map,clickedKey="";function getKeyboardLayout(){return(document.querySelector("[data-about-keyboard-melodies]").getAttribute("data-about-keyboard-melodies")||"QWERTY").toUpperCase()}function reLabelKeys(){Array.from(document.querySelectorAll("[data-note]")).forEach(function(e){var t=e.getAttribute("data-note"),o=parseInt(e.getAttribute("data-octave"),10),a=getKeyByNoteOctave(t,o),n="AZERTY"===getKeyboardLayout()?a.keyAzerty:a.key;e.innerText=n})}function getKeyDataByKeyNote(e){return{element:document.querySelector('[data-note="'.concat(e.note,'"][data-octave="').concat(e.octave,'"]')),note:e.note,octave:e.octave}}var currMelody=!1,melodySteps=!1;function autoplayMelody(e,a,n){var r=0;clearInterval(melodySteps),!1!==currMelody&&document.querySelector('.melody-play[aria-pressed="true"]').setAttribute("aria-pressed","false");currMelody!==e?(n.setAttribute("aria-pressed","true"),currMelody=e,melodySteps=setInterval(function(){var e=a[r],t=getNoteByKey(e);if(t){var o=getKeyDataByKeyNote(t);playKey(clickedKey=o),setTimeout(function(){return stopKey(clickedKey)},100)}++r>=a.length&&(clearInterval(melodySteps),currMelody=!1,n.setAttribute("aria-pressed","false"))},200)):currMelody=!1}function showMelodies(){var s="AZERTY"===getKeyboardLayout(),u=document.querySelector("[data-about-keyboard-melodies]"),c=u.getAttribute("data-about-melodies-label");melodies.forEach(function(e,t){var o=s?e.map(function(e){return getAzertyForKey(e)}):e,a=document.createElement("br"),n=document.createElement("button"),r=document.createElement("kbd"),i=o.filter(function(e){return" "!==e});r.innerText=i.join(", ")+".",n.classList.add("button--reset","melody-play"),n.setAttribute("type","button"),n.setAttribute("aria-label",c+" #"+(t+1)),n.setAttribute("aria-pressed","false"),n.setAttribute("data-melody",t),n.addEventListener("click",function(){autoplayMelody(t,o,n)}),u.appendChild(a),u.appendChild(n),u.appendChild(r)}),u.hidden=!1}function triggerKey(e,t,o){var a={element:e,note:t,octave:o};playKey(clickedKey=a)}document.addEventListener("mousemove",function(e){mousePosition.new=e.clientX!==mousePosition.x||e.clientY!==mousePosition.y,mousePosition.x=e.clientX,mousePosition.y=e.clientY},!1),document.addEventListener("mousedown",function(e){var t=e.target.closest("[data-note]");if(t)return e.preventDefault(),triggerKey(t,t.getAttribute("data-note"),parseInt(t.getAttribute("data-octave"),10)),!1},!1),document.addEventListener("mouseup",function(){stopKey(clickedKey)},!1),document.addEventListener("keydown",function(e){var t=e.key.toUpperCase();if(!(e.altKey||e.metaKey||e.ctrlKey||e.shiftKey))if("ENTER"!==t&&" "!==t){var o=getNoteByKey(t);if(o){var a=getKeyDataByKeyNote(o);playKey(clickedKey=a)}}else{var n=e.target.closest("[data-note]");if(!n)return;triggerKey(n,n.getAttribute("data-note"),parseInt(n.getAttribute("data-octave"),10))}}),document.addEventListener("keyup",function(){stopKey(clickedKey)},!1);