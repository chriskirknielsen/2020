---
layout: layouts/base.njk
section: home
---

<section class="homescreen u-displayFlex u-flex--stretch u-breakout u-paddingInline--double" aria-label="Chris Kirk-Nielsen: creative developer, in a heavily eighties-inspired graphical style with neon colours, a perspective grid, and a big sun in the background">
	<div class="homescreen__wrapper u-displayFlex u-flex--centre u-posRelative u-afterCover u-width--100">
        <div class="homescreen__background u-displayFlex u-flex--centre u-posAbsolute u-absCover u-bg--primary-max u-overflowHidden u-beforeCover u-afterCover" aria-hidden="true">
            <canvas id="homescreen-scene" class="homescreen__scene u-posRelative"></canvas>
        </div>

        <div class="homescreen__svg-wrapper u-posRelative">
            {% set ckn_mark %}
            {% include "assets/img/home-mark.njk" %}
            {% endset %}
            {{ ckn_mark | htmlmin | safe }}
        </div>
        
        <script type="text/javascript">
        {% set scene_script %}
            (function(){
                var pathInitialDelay = 800;
                var pathDrawDelay = 100;
                var cknMarkKnPaths = document.getElementById('ckn-mark-kn-draw').children;
                for (var p = 0, ps = cknMarkKnPaths.length; p < ps; p++) {
                    var path = cknMarkKnPaths[p];
                    var pathLength = path.getTotalLength();
                    path.style.strokeDasharray = pathLength + ' ' + pathLength;
                    path.style.strokeDashoffset = pathLength;
                    
                    setTimeout(function(pData) {
                        var drawLength = pData.pathLength;
                        pData.path.style.strokeDashoffset = 0; // pData.pathLength - drawLength;
                    }, pathDrawDelay*p + pathInitialDelay, { path: path, pathLength: pathLength });
                }
            })();

            if (window.CSS.registerProperty) {
                window.CSS.registerProperty({
                    name: '--ckn-sun-mask-lines',
                    syntax: '<length-percentage>',
                    inherits: true,
                    initialValue: '0',
                });
            }
            (function(){
                var scene = document.getElementById('homescreen-scene');
                var sceneRender = 'webgl'; // Default value
                var sceneCtx = null;//scene.getContext('webgl') || scene.getContext("experimental-webgl");
                var addHomescreenSceneScript = function(ctx) {
                    if (ctx === null) {
                        scene.parentElement.removeChild(scene);
                        return;
                    }

                    if (ctx === 'webgl') {
                        sceneScriptUrl = "{{ '/assets/jsmin/homescreen-scene-webgl.min.js' | url }}";
                    }
                    else if (ctx === '2d') {
                        sceneScriptUrl = "{{ '/assets/jsmin/homescreen-scene-2d.min.js' | url }}";
                    }

                    window.sceneCanvas = scene; // Accessible in the global scope

                    var sceneScript = document.createElement('script');
                    sceneScript.src = sceneScriptUrl;
                    sceneScript.setAttribute('deferred', true);
                    
                    document.body.appendChild(sceneScript);
                }

                if (sceneCtx === null) {
                    sceneRender = '2d';
                    sceneCtx = scene.getContext('2d');

                    if (sceneCtx === null) { sceneRender = null; }
                }

                addHomescreenSceneScript(sceneRender);
            })();
        {% endset %}
        {{ scene_script | jsmin | safe }}
        </script>
    </div>
</section>

<section class="u-marginBlockStart--double u-paddingBlockStart--none u-flow">
    {{ layoutContent | safe }}
</section>
